<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Kalife_1 | جنگجوی کد</title>
    <!-- استایل‌های قبلی بدون تغییر -->
    <style>
        /* تمام استایل‌های قبلی شما دقیقاً مانند قبل باقی می‌مانند */
        
        #audioPermission {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: #d4af37;
            text-align: center;
            padding: 20px;
        }
        
        #startAudio {
            background: #8B0000;
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 15px 30px;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        #startAudio:hover {
            background: #d4af37;
            color: #8B0000;
        }
    </style>
</head>
<body>
    <!-- لایه درخواست فعال‌سازی صدا -->
    <div id="audioPermission">
        <h2>⚔️ برای تجربه کامل میدان نبرد ⚔️</h2>
        <p>لطفاً برای پخش موسیقی حماسی جنگ‌های صلیبی دکمه زیر را فشار دهید</p>
        <button id="startAudio">فعال‌سازی موسیقی نبرد</button>
        <p style="font-size: 14px; margin-top: 20px; color: #aaa;">(این اقدام برای رعایت قوانین مرورگرها ضروری است)</p>
    </div>

    <!-- محتوای اصلی سایت (بدون تغییر) -->
    <div class="warrior-container">
        <!-- تمام محتوای قبلی شما -->
    </div>

    <script>
        // ذخیره context صدا
        let audioContext;
        let musicBuffer;
        let musicSource;
        
        // بارگیری آهنگ
        async function loadAudio() {
            try {
                const response = await fetch('https://ememay.ir/wp-content/uploads/2024/04/Robert-L.-Euvino-A-Strong-Spice.mp3');
                const arrayBuffer = await response.arrayBuffer();
                musicBuffer = await audioContext.decodeAudioData(arrayBuffer);
                playAudio();
            } catch (error) {
                console.error('خطا در بارگیری آهنگ:', error);
            }
        }
        
        // پخش آهنگ
        function playAudio() {
            musicSource = audioContext.createBufferSource();
            musicSource.buffer = musicBuffer;
            musicSource.loop = true;
            
            // تنظیم صدا روی 100%
            const gainNode = audioContext.createGain();
            gainNode.gain.value = 1.0;
            
            musicSource.connect(gainNode);
            gainNode.connect(audioContext.destination);
            musicSource.start();
        }
        
        // دکمه فعال‌سازی
        document.getElementById('startAudio').addEventListener('click', function() {
            // ایجاد context صدا پس از تعامل کاربر
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // بارگیری و پخش آهنگ
            loadAudio();
            
            // مخفی کردن لایه درخواست
            document.getElementById('audioPermission').style.display = 'none';
            
            // ذخیره در localStorage برای بازدیدهای بعدی
            localStorage.setItem('audioPermission', 'granted');
        });
        
        // بررسی اجازه قبلی
        if (localStorage.getItem('audioPermission') === 'granted') {
            document.getElementById('audioPermission').style.display = 'none';
            document.addEventListener('click', function initAudio() {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                loadAudio();
                document.removeEventListener('click', initAudio);
            }, { once: true });
        }
    </script>
</body>
</html>
